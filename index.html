<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AFAD Ä°letiÅŸim</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        input, button {
            padding: 10px;
            margin: 5px;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            padding: 5px;
            background: #f4f4f4;
            margin: 5px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>AFAD Telsiz UygulamasÄ±</h1>

    <!-- KullanÄ±cÄ± adÄ± ve oda adÄ± giriÅŸi -->
    <input type="text" id="kullaniciAdi" placeholder="AdÄ±nÄ±zÄ± girin...">
    <input type="text" id="odaAdi" placeholder="Oda (mahalle/ekip) adÄ±...">
    <button onclick="baglan()">BaÄŸlan</button>

    <!-- Sohbet bÃ¶lÃ¼mÃ¼ -->
    <div id="chat" style="display: none;">
        <input type="text" id="mesaj" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n...">
        <button onclick="mesajGonder()">GÃ¶nder</button>
        <button onclick="konumGonder()">Konum GÃ¶nder</button>

        <h3>Gelen Mesajlar:</h3>
        <ul id="mesajlar"></ul>
    </div>

    <script>
        const socket = io("http://192.168.1.72:3000"); // Sunucu adresin
        let oda = "";
        let kullanici = "";

        function baglan() {
            oda = document.getElementById("odaAdi").value;
            kullanici = document.getElementById("kullaniciAdi").value;

            if (!oda || !kullanici) {
                alert("LÃ¼tfen adÄ±nÄ±zÄ± ve oda adÄ±nÄ± girin.");
                return;
            }

            socket.emit("oda_katil", oda);
            document.getElementById("chat").style.display = "block";
        }

        function mesajGonder() {
            const mesaj = document.getElementById("mesaj").value;
            if (!mesaj) return;

            socket.emit("mesaj_gonder", {
                oda,
                kullanici,
                mesaj
            });

            document.getElementById("mesaj").value = "";
        }

        function konumGonder() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const konum = {
                        oda,
                        enlem: position.coords.latitude,
                        boylam: position.coords.longitude
                    };
                    socket.emit("konum_gonder", konum);
                    alert(`Konum gÃ¶nderildi: Enlem ${konum.enlem}, Boylam ${konum.boylam}`);
                });
            } else {
                alert("Konum servisi desteklenmiyor.");
            }
        }

        socket.on("mesaj_al", data => {
            const li = document.createElement("li");
            li.textContent = `${data.kullanici}: ${data.mesaj}`;
            document.getElementById("mesajlar").appendChild(li);
        });

        socket.on("konum_al", konum => {
            const li = document.createElement("li");
            li.textContent = `ðŸ“ Konum alÄ±ndÄ±: Enlem ${konum.enlem}, Boylam ${konum.boylam}`;
            document.getElementById("mesajlar").appendChild(li);
        });

        socket.on("sistem_mesaji", (msg) => {
            const li = document.createElement("li");
            li.textContent = `ðŸ”” ${msg}`;
            li.style.fontStyle = "italic";
            document.getElementById("mesajlar").appendChild(li);
        });
    </script>
</body>
</html>
